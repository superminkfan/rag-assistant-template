<?xml version="1.0" encoding="UTF-8"?>

<!--
     !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
           MANAGED WITH ANSIBLE
               DO NOT EDIT
     !!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!
-->

<!--
  Licensed to the Apache Software Foundation (ASF) under one or more
  contributor license agreements.  See the NOTICE file distributed with
  this work for additional information regarding copyright ownership.
  The ASF licenses this file to You under the Apache License, Version 2.0
  (the "License"); you may not use this file except in compliance with
  the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xmlns:util="http://www.springframework.org/schema/util"
       xsi:schemaLocation="
            http://www.springframework.org/schema/beans
            http://www.springframework.org/schema/beans/spring-beans.xsd
            http://www.springframework.org/schema/util
            http://www.springframework.org/schema/util/spring-util.xsd">

    <bean abstract="false"  id="ignIgniteConfiguration" class="org.apache.ignite.configuration.IgniteConfiguration">


        <property name="binaryConfiguration">
            <bean class="org.apache.ignite.configuration.BinaryConfiguration">
                <property name="compactFooter" value="true"/>
            </bean>
        </property>
    
        <!-- start macro property_TcpDiscoverySpi -->
        <property name="discoverySpi" ref="TcpDiscoverySpi"/>
        <!-- end macro property_TcpDiscoverySpi -->

        <!-- #  Log4J2_enable: True # -->
    
        <!-- macro_datagridLogger -->
        <property name="gridLogger">
            <bean class="org.apache.ignite.logger.log4j2.Log4J2Logger">
                <constructor-arg type="java.lang.String" value="/opt/ignite/server/config/ignite-log4j2.xml"/>
            </bean>
        </property>
        <!-- macro_datagridLogger -->


        <property name="communicationSpi" ref="ignTcpCommunicationSpi"/>

        
        <!-- start macro property metricExporterSpi -->
        <property name="metricExporterSpi">
          <list>
            <bean class="org.apache.ignite.spi.metric.jmx.JmxMetricExporterSpi"/>
          </list>
        </property>
        <!-- end macro property metricExporterSpi -->


        <property name="consistentId"            value="#{systemProperties['IGNITE_CLUSTER_NAME'] + '_' + localhostInetAddress.hostName}"/>
        <property name="workDirectory"           value="/opt/ignite/server/work"/>
        <property name="metricsLogFrequency"     value="30000"/>
        <property name="failureDetectionTimeout" value="30000"/>
        <property name="rebalanceThreadPoolSize" value="4"/>
        <property name="peerClassLoadingEnabled" value="true"/>

        <property name="dataStorageConfiguration" ref="ignDataStorageConfiguration"/>
        <property name="transactionConfiguration" ref="ignTransactionConfiguration"/>

        <property name="connectorConfiguration" ref="ignConnectorConfiguration"/>

        <property name="clientConnectorConfiguration" ref="ignClientConnectorConfiguration"/>


    
        <!-- start macro property_pluginProviders -->
        <property name="pluginProviders">
            <list>
                <ref bean="server_securityPlugin"/>
                <bean class = "com.sbt.ignite.cdc.CdcManagerPluginProvider">
                    <constructor-arg ref="cdcManager"/>
                </bean>
                <bean class="com.sbt.ignite.CheckParametersPluginProvider">
                    <property name="stopNodeOnCheckFailure"  value="false" />
                    <property name="nodeAttributesHardCheck" value="true" />
                </bean>
                <bean class="org.apache.ignite.cdc.conflictresolve.CacheVersionConflictResolverPluginProvider">
                    <property name="clusterId" value="0"/>
                    <property name="caches">
                        <set>
                            <value>SQL_PUBLIC_MYTABLE</value>
                        </set>
                    </property>
                    <property name="conflictResolveField" value="version"/>
                </bean>            </list>
        </property>
        <!-- end macro property_pluginProviders -->



        <property name="cacheConfiguration" ref="ignCacheConfiguration"/>

        <property name="snapshotPath" value="/opt/ignite/server/snapshot"/>
        <property name="snapshotThreadPoolSize"  value="4"/>

    </bean>

    <!-- ############# inc/bean/ ############# -->

    
    <!-- start macro bean_TcpDiscoverySpi -->
    <bean id="TcpDiscoverySpi" class="org.apache.ignite.spi.discovery.tcp.TcpDiscoverySpi">
        <property name="localPort"                 value="47500"/>
        <property name="localPortRange"            value="9"/>
        <property name="connectionRecoveryTimeout" value="30000"/>
        <property name="ipFinder">
            <bean class="org.apache.ignite.spi.discovery.tcp.ipfinder.vm.TcpDiscoveryVmIpFinder">
                <property name="addresses">
                    <list>
                        <value>1.2.3.4:47500..47520</value>
                        <value>1.2.3.5:47600..47620</value>
                    </list>
                </property>
            </bean>
        </property>
    </bean>
    <!-- end macro bean_TcpDiscoverySpi-->



        
    <!-- start macro bean_securityPlugin21 -->
    <bean id="server_securityPlugin" class="com.sbt.security.ignite.core.SecurityPluginProvider">
        <constructor-arg ref="server_securityPluginConfiguration"/>
    </bean>
    <bean id="server_securityPluginConfiguration" class="com.sbt.security.ignite.core.SecurityPluginConfiguration">
        <property name="nodeLogin"            value="ise_server"/>
        <property name="nodePassword"         value="password"/>
        <property name="trustStorePath"       value="path/to/trustStore"/>
        <property name="trustStorePassword"   value="password"/>
        <property name="selfKeyStorePath"     value="path/to/selfKeyStore"/>
        <property name="selfKeyStorePassword" value="password"/>
        <property name="userDataStore"        value="path/to/userDataStore"/>
        <property name="auditIntegrationConfiguration" ref="auditIntegrationConfiguration"/>
    </bean>
    <!-- end macro bean_securityPlugin21 -->



  <!-- audit: True -->

    <bean id="auditIntegrationConfiguration" class="com.sbt.security.ignite.integration.audit3.AuditConnectionConfiguration">
            <property name="sourceSystemName" value="password"/>
            <property name="moduleName" value="igniteSE"/>
            <property name="nodeName" value="#{localhostInetAddress.hostName}"/>
            <property name="connectionProperties">
                <bean class="org.springframework.beans.factory.config.PropertiesFactoryBean">
                    <property name="locations">
                        <list>
                            <value>file:/opt/ignite/server/config/audit.cfg</value>
                        </list>
                    </property>
                </bean>
            </property>
    </bean>



  <!-- configurator: False -->

    <!-- # inc/bean/ignTcpCommunicationSpi.xml # -->

    <bean id="ignTcpCommunicationSpi" class="org.apache.ignite.spi.communication.tcp.TcpCommunicationSpi">
        <property name="localPort"             value="47100"/>
        <property name="localAddress"          value="#{localhostInetAddress.getHostAddress()}"/>
        <property name="sharedMemoryPort"      value="-1"/>
        <property name="idleConnectionTimeout" value="600000"/>
        <property name="socketWriteTimeout"    value="30000"/>
        <property name="selectorsCount"        value="18"/>
        <property name="connectionsPerNode"    value="1"/>
        <property name="usePairedConnections"  value="false"/>
        <property name="messageQueueLimit"     value="0"/>
    </bean>    <!-- ## inc/bean/ignTcpCommunicationSpi.xml ## -->

    <!-- # cacheConfiguration: 1 > 0 # -->
    <!-- # inc/bean/cacheConfiguration.xml # -->

    <!-- list ignCacheConfiguration-->
    <util:list id="ignCacheConfiguration">

    <!-- bean ignCache SQL_PUBLIC_MYTABLE -->
    <bean class="org.apache.ignite.configuration.CacheConfiguration">
        <property name="name" value="SQL_PUBLIC_MYTABLE"/>
        <property name="statisticsEnabled" value="true"/>
        <property name="backups" value="0"/>
        <property name="sqlSchema" value="public"/>
        <property name="cacheMode" value="PARTITIONED"/>
        <property name="atomicityMode" value="TRANSACTIONAL"/>
    </bean>
    <!-- bean ignCache SQL_PUBLIC_MYTABLE -->
    </util:list>
    <!-- list ignCacheConfiguration-->    <!-- ## inc/bean/cacheConfiguration.xml ## -->

    <!-- bean ignConnectorConfiguration-->
    <bean id="ignConnectorConfiguration" class="org.apache.ignite.configuration.ConnectorConfiguration">
        <property name="host"          value="0.0.0.0"/>
        <property name="port"          value="11211"/>
	    <property name="idleTimeout"   value="180000"/>
    </bean>
    <!-- end of bean ignConnectorConfiguration-->
    <!-- bean ignClientConnectorConfiguration -->
    <bean id="ignClientConnectorConfiguration" class="org.apache.ignite.configuration.ClientConnectorConfiguration">
        <property name="host"           value="0.0.0.0"/>
        <property name="port"           value="10800"/>
        <property name="portRange"      value="100"/>
        <property name="jdbcEnabled"    value="true"/>
        <property name="odbcEnabled"    value="false"/>
        <property name="threadPoolSize" value="4"/>

        <property name="thinClientEnabled" value="true"/>
        <property name="thinClientConfiguration" ref="thinClientConfiguration"/>
      

    </bean>
    <!-- end of bean ClientConnectorConfiguration -->
    <!-- bean thinClientConfiguration -->
    <bean id="thinClientConfiguration" class="org.apache.ignite.configuration.ThinClientConfiguration">
        <property name="maxActiveComputeTasksPerConnection" value="100"/>
    </bean>
    <!-- end of bean thinClientConfiguration -->
    <!-- TransactionConfiguration -->
    <bean id="ignTransactionConfiguration"  class="org.apache.ignite.configuration.TransactionConfiguration">
        <property name="defaultTxIsolation"              value="READ_COMMITTED"/>
        <property name="defaultTxTimeout"                value="300000"/>
        <property name="txTimeoutOnPartitionMapExchange" value="10000"/>
    </bean>
    <!-- end of TransactionConfiguration -->
    <!-- start bean ignDefaultDataRegionConfiguration -->
    <bean id="ignDefaultDataRegionConfiguration" class="org.apache.ignite.configuration.DataRegionConfiguration">
        <property name="name"                       value="default"/>

        <property name="maxSize"                    value="#{9L * 1024 * 1024 * 1024}"/>
        <property name="metricsEnabled"                    value="true"/>
        <property name="metricsRateTimeInterval"                    value="1000"/>
        <property name="persistenceEnabled"                    value="true"/>
        <property name="cdcEnabled"                    value="True"/>
    </bean>
        <!-- end of bean ignDefaultDataRegionConfiguration -->
    <!-- bean ignDataStorageConfiguration -->
    <!-- A durable memory configuration for an Apache Ignite node. -->
    <bean id="ignDataStorageConfiguration" class="org.apache.ignite.configuration.DataStorageConfiguration">

        <!-- Overrides configuration of default data region which is created automatically. -->
        <property name="defaultDataRegionConfiguration" ref="ignDefaultDataRegionConfiguration"/>

        <property name="cdcWalPath" value="/opt/ignite/server/wal_archive/cdc" />
        <property name="walForceArchiveTimeout" value="10000" />

        <!-- Changes the page size. -->
        <!-- org.apache.ignite.configuration.DataStorageConfiguration.DFLT_PAGE_SIZE = 4Kb -->
        <property name="pageSize" value="#{4 * 1024}"/>

        <property name="storagePath" value="/opt/ignite/server/data"/>
        <!-- Sets the checkpoint frequency which is a minimal interval when the dirty pages will be written to the Persistent Store. -->
        <property name="checkpointFrequency" value="60000"/>

        <!-- Sets a total number of checkpoints to keep in the WAL history. -->
        <property name="walHistorySize" value="2147483647"/>

        <!-- Sets a path for the WAL archive directory. -->
        <property name="walArchivePath" value="/opt/ignite/server/wal_archive"/>

        <property name="walPath" value="/opt/ignite/server/wal"/>
        <!-- Sets size of a WAL segment. -->
        <property name="walSegmentSize" value="#{1024*1024*1024}"/>

        <!-- Sets property that defines behavior of wal fsync. -->
        <property name="walMode" value="LOG_ONLY"/>
        <property name="metricsEnabled" value="true"/>
        <property name="metricsRateTimeInterval" value="60000"/>
        <!-- Sets WAL buffer size. -->
        <property name="walBufferSize"        value="5242880"/>
        <!-- Sets flag indicating whether WAL compaction is enabled. -->
        <property name="walCompactionEnabled" value="true"/>


    </bean>
    <!-- end of bean ignDataStorageConfiguration -->
    <!-- # ONLINE CDC True # -->
    <bean id = "cdcManager" class = "com.sbt.ignite.cdc.CdcManagerPluginConfiguration">
        <property name="bufferSize" value="1073741824"/>
        <property name="consumer"   ref="cdcStreamer"/>
        <property name="keepBinary" value="true"/>
    </bean>


    <bean id="cdcStreamer" class="org.apache.ignite.cdc.thin.IgniteToIgniteClientCdcStreamer">
         <property name="destinationClientConfiguration" ref="cdc_clientIgnite"/>




        <property name="maxBatchSize" value="256"/>
        <property name="onlyPrimary" value="True"/>
        <property name="caches">
            <util:list>
                <value>SQL_PUBLIC_MYTABLE</value>
            </util:list>
        </property>    </bean>


    <!-- start macro thinClient -->
    <bean id="cdc_clientIgnite" class="org.apache.ignite.configuration.ClientConfiguration">
         <property name="addresses">
            <list>
                 <value>1.2.3.5:8080</value>
            </list>
         </property>
         <property name="sslMode"                              value="REQUIRED"/>
         <property name="userName"                             value="ise_client"/>
         <property name="userPassword"                         value="password"/>
         <property name="sslClientCertificateKeyStorePath"     value="path/to/KeyStore"/>
         <property name="sslClientCertificateKeyStorePassword" value="password"/>
         <property name="sslTrustCertificateKeyStorePath"      value="path/to/KeyStore"/>
         <property name="sslTrustCertificateKeyStorePassword"  value="password"/>
    </bean>
    <!-- end macro thinClient -->

    <!-- ## ONLINE CDC True ## -->


    <bean id="localhostInetAddress" class="java.net.InetAddress" factory-method="getLocalHost"/>
<!-- end configuration DataGrid -->
</beans>